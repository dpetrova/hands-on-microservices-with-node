function cov_fqe46mkqw(){var path="D:\\PROGRAMMING\\JS\\Diogo Resende - Hands-on Microservices With Node.js\\projects\\Chapter 5  - Testing\\imagini.js";var hash="d183c4f4559f3fbeb05916402583e7ac9b82ad9e";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"D:\\PROGRAMMING\\JS\\Diogo Resende - Hands-on Microservices With Node.js\\projects\\Chapter 5  - Testing\\imagini.js",statementMap:{"0":{start:{line:1,column:19},end:{line:1,column:41}},"1":{start:{line:2,column:16},end:{line:2,column:34}},"2":{start:{line:3,column:13},end:{line:3,column:28}},"3":{start:{line:4,column:14},end:{line:4,column:30}},"4":{start:{line:5,column:14},end:{line:5,column:30}},"5":{start:{line:6,column:17},end:{line:6,column:38}},"6":{start:{line:8,column:12},end:{line:8,column:21}},"7":{start:{line:9,column:11},end:{line:9,column:46}},"8":{start:{line:11,column:0},end:{line:11,column:12}},"9":{start:{line:13,column:0},end:{line:132,column:3}},"10":{start:{line:14,column:1},end:{line:14,column:20}},"11":{start:{line:14,column:10},end:{line:14,column:20}},"12":{start:{line:16,column:1},end:{line:16,column:26}},"13":{start:{line:19,column:1},end:{line:32,column:3}},"14":{start:{line:35,column:1},end:{line:48,column:4}},"15":{start:{line:36,column:2},end:{line:38,column:3}},"16":{start:{line:37,column:3},end:{line:37,column:32}},"17":{start:{line:40,column:2},end:{line:47,column:5}},"18":{start:{line:41,column:3},end:{line:43,column:4}},"19":{start:{line:42,column:4},end:{line:42,column:33}},"20":{start:{line:45,column:3},end:{line:45,column:25}},"21":{start:{line:46,column:3},end:{line:46,column:17}},"22":{start:{line:51,column:1},end:{line:60,column:4}},"23":{start:{line:52,column:2},end:{line:59,column:5}},"24":{start:{line:53,column:3},end:{line:56,column:4}},"25":{start:{line:54,column:4},end:{line:54,column:31}},"26":{start:{line:55,column:4},end:{line:55,column:58}},"27":{start:{line:58,column:3},end:{line:58,column:54}},"28":{start:{line:63,column:1},end:{line:65,column:4}},"29":{start:{line:64,column:2},end:{line:64,column:31}},"30":{start:{line:68,column:1},end:{line:100,column:4}},"31":{start:{line:70,column:2},end:{line:75,column:3}},"32":{start:{line:71,column:3},end:{line:71,column:90}},"33":{start:{line:72,column:3},end:{line:73,column:43}},"34":{start:{line:74,column:3},end:{line:74,column:34}},"35":{start:{line:78,column:14},end:{line:78,column:35}},"36":{start:{line:79,column:14},end:{line:79,column:30}},"37":{start:{line:80,column:15},end:{line:80,column:32}},"38":{start:{line:81,column:13},end:{line:81,column:28}},"39":{start:{line:82,column:16},end:{line:82,column:34}},"40":{start:{line:83,column:18},end:{line:83,column:80}},"41":{start:{line:84,column:13},end:{line:84,column:70}},"42":{start:{line:85,column:13},end:{line:85,column:70}},"43":{start:{line:87,column:8},end:{line:87,column:79}},"44":{start:{line:87,column:37},end:{line:87,column:79}},"45":{start:{line:88,column:8},end:{line:88,column:81}},"46":{start:{line:88,column:37},end:{line:88,column:81}},"47":{start:{line:89,column:8},end:{line:89,column:39}},"48":{start:{line:89,column:22},end:{line:89,column:39}},"49":{start:{line:90,column:8},end:{line:90,column:48}},"50":{start:{line:90,column:25},end:{line:90,column:48}},"51":{start:{line:91,column:8},end:{line:91,column:41}},"52":{start:{line:91,column:23},end:{line:91,column:41}},"53":{start:{line:92,column:8},end:{line:92,column:31}},"54":{start:{line:92,column:18},end:{line:92,column:31}},"55":{start:{line:93,column:8},end:{line:93,column:31}},"56":{start:{line:93,column:18},end:{line:93,column:31}},"57":{start:{line:95,column:2},end:{line:95,column:89}},"58":{start:{line:97,column:2},end:{line:97,column:83}},"59":{start:{line:99,column:2},end:{line:99,column:18}},"60":{start:{line:103,column:1},end:{line:107,column:4}},"61":{start:{line:104,column:2},end:{line:106,column:5}},"62":{start:{line:105,column:3},end:{line:105,column:44}},"63":{start:{line:110,column:1},end:{line:119,column:4}},"64":{start:{line:111,column:2},end:{line:118,column:5}},"65":{start:{line:112,column:3},end:{line:114,column:4}},"66":{start:{line:113,column:4},end:{line:113,column:33}},"67":{start:{line:116,column:3},end:{line:116,column:37}},"68":{start:{line:117,column:3},end:{line:117,column:28}},"69":{start:{line:122,column:1},end:{line:127,column:3}},"70":{start:{line:123,column:2},end:{line:125,column:65}},"71":{start:{line:129,column:1},end:{line:131,column:4}},"72":{start:{line:130,column:2},end:{line:130,column:28}},"73":{start:{line:134,column:0},end:{line:134,column:21}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:13,column:11},end:{line:13,column:12}},loc:{start:{line:13,column:20},end:{line:132,column:1}},line:13},"1":{name:"(anonymous_1)",decl:{start:{line:35,column:20},end:{line:35,column:21}},loc:{start:{line:35,column:47},end:{line:48,column:2}},line:35},"2":{name:"(anonymous_2)",decl:{start:{line:40,column:61},end:{line:40,column:62}},loc:{start:{line:40,column:78},end:{line:47,column:3}},line:40},"3":{name:"(anonymous_3)",decl:{start:{line:51,column:78},end:{line:51,column:79}},loc:{start:{line:51,column:92},end:{line:60,column:2}},line:51},"4":{name:"(anonymous_4)",decl:{start:{line:52,column:103},end:{line:52,column:104}},loc:{start:{line:52,column:112},end:{line:59,column:3}},line:52},"5":{name:"(anonymous_5)",decl:{start:{line:63,column:29},end:{line:63,column:30}},loc:{start:{line:63,column:43},end:{line:65,column:2}},line:63},"6":{name:"(anonymous_6)",decl:{start:{line:68,column:28},end:{line:68,column:29}},loc:{start:{line:68,column:42},end:{line:100,column:2}},line:68},"7":{name:"(anonymous_7)",decl:{start:{line:103,column:31},end:{line:103,column:32}},loc:{start:{line:103,column:45},end:{line:107,column:2}},line:103},"8":{name:"(anonymous_8)",decl:{start:{line:104,column:64},end:{line:104,column:65}},loc:{start:{line:104,column:73},end:{line:106,column:3}},line:104},"9":{name:"(anonymous_9)",decl:{start:{line:110,column:19},end:{line:110,column:20}},loc:{start:{line:110,column:33},end:{line:119,column:2}},line:110},"10":{name:"(anonymous_10)",decl:{start:{line:111,column:90},end:{line:111,column:91}},loc:{start:{line:111,column:105},end:{line:118,column:3}},line:111},"11":{name:"(anonymous_11)",decl:{start:{line:122,column:13},end:{line:122,column:14}},loc:{start:{line:122,column:19},end:{line:126,column:3}},line:122},"12":{name:"(anonymous_12)",decl:{start:{line:129,column:18},end:{line:129,column:19}},loc:{start:{line:129,column:24},end:{line:131,column:2}},line:129}},branchMap:{"0":{loc:{start:{line:14,column:1},end:{line:14,column:20}},type:"if",locations:[{start:{line:14,column:1},end:{line:14,column:20}},{start:{line:14,column:1},end:{line:14,column:20}}],line:14},"1":{loc:{start:{line:36,column:2},end:{line:38,column:3}},type:"if",locations:[{start:{line:36,column:2},end:{line:38,column:3}},{start:{line:36,column:2},end:{line:38,column:3}}],line:36},"2":{loc:{start:{line:41,column:3},end:{line:43,column:4}},type:"if",locations:[{start:{line:41,column:3},end:{line:43,column:4}},{start:{line:41,column:3},end:{line:43,column:4}}],line:41},"3":{loc:{start:{line:41,column:7},end:{line:41,column:28}},type:"binary-expr",locations:[{start:{line:41,column:7},end:{line:41,column:10}},{start:{line:41,column:14},end:{line:41,column:28}}],line:41},"4":{loc:{start:{line:53,column:3},end:{line:56,column:4}},type:"if",locations:[{start:{line:53,column:3},end:{line:56,column:4}},{start:{line:53,column:3},end:{line:56,column:4}}],line:53},"5":{loc:{start:{line:70,column:2},end:{line:75,column:3}},type:"if",locations:[{start:{line:70,column:2},end:{line:75,column:3}},{start:{line:70,column:2},end:{line:75,column:3}}],line:70},"6":{loc:{start:{line:87,column:8},end:{line:87,column:79}},type:"if",locations:[{start:{line:87,column:8},end:{line:87,column:79}},{start:{line:87,column:8},end:{line:87,column:79}}],line:87},"7":{loc:{start:{line:87,column:12},end:{line:87,column:35}},type:"binary-expr",locations:[{start:{line:87,column:12},end:{line:87,column:21}},{start:{line:87,column:25},end:{line:87,column:35}}],line:87},"8":{loc:{start:{line:88,column:8},end:{line:88,column:81}},type:"if",locations:[{start:{line:88,column:8},end:{line:88,column:81}},{start:{line:88,column:8},end:{line:88,column:81}}],line:88},"9":{loc:{start:{line:88,column:12},end:{line:88,column:35}},type:"binary-expr",locations:[{start:{line:88,column:12},end:{line:88,column:21}},{start:{line:88,column:25},end:{line:88,column:35}}],line:88},"10":{loc:{start:{line:88,column:50},end:{line:88,column:63}},type:"binary-expr",locations:[{start:{line:88,column:50},end:{line:88,column:55}},{start:{line:88,column:59},end:{line:88,column:63}}],line:88},"11":{loc:{start:{line:88,column:65},end:{line:88,column:79}},type:"binary-expr",locations:[{start:{line:88,column:65},end:{line:88,column:71}},{start:{line:88,column:75},end:{line:88,column:79}}],line:88},"12":{loc:{start:{line:89,column:8},end:{line:89,column:39}},type:"if",locations:[{start:{line:89,column:8},end:{line:89,column:39}},{start:{line:89,column:8},end:{line:89,column:39}}],line:89},"13":{loc:{start:{line:90,column:8},end:{line:90,column:48}},type:"if",locations:[{start:{line:90,column:8},end:{line:90,column:48}},{start:{line:90,column:8},end:{line:90,column:48}}],line:90},"14":{loc:{start:{line:91,column:8},end:{line:91,column:41}},type:"if",locations:[{start:{line:91,column:8},end:{line:91,column:41}},{start:{line:91,column:8},end:{line:91,column:41}}],line:91},"15":{loc:{start:{line:92,column:8},end:{line:92,column:31}},type:"if",locations:[{start:{line:92,column:8},end:{line:92,column:31}},{start:{line:92,column:8},end:{line:92,column:31}}],line:92},"16":{loc:{start:{line:93,column:8},end:{line:93,column:31}},type:"if",locations:[{start:{line:93,column:8},end:{line:93,column:31}},{start:{line:93,column:8},end:{line:93,column:31}}],line:93},"17":{loc:{start:{line:105,column:21},end:{line:105,column:36}},type:"cond-expr",locations:[{start:{line:105,column:27},end:{line:105,column:30}},{start:{line:105,column:33},end:{line:105,column:36}}],line:105},"18":{loc:{start:{line:112,column:3},end:{line:114,column:4}},type:"if",locations:[{start:{line:112,column:3},end:{line:114,column:4}},{start:{line:112,column:3},end:{line:114,column:4}}],line:112}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0,"19":0,"20":0,"21":0,"22":0,"23":0,"24":0,"25":0,"26":0,"27":0,"28":0,"29":0,"30":0,"31":0,"32":0,"33":0,"34":0,"35":0,"36":0,"37":0,"38":0,"39":0,"40":0,"41":0,"42":0,"43":0,"44":0,"45":0,"46":0,"47":0,"48":0,"49":0,"50":0,"51":0,"52":0,"53":0,"54":0,"55":0,"56":0,"57":0,"58":0,"59":0,"60":0,"61":0,"62":0,"63":0,"64":0,"65":0,"66":0,"67":0,"68":0,"69":0,"70":0,"71":0,"72":0,"73":0},f:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0},b:{"0":[0,0],"1":[0,0],"2":[0,0],"3":[0,0],"4":[0,0],"5":[0,0],"6":[0,0],"7":[0,0],"8":[0,0],"9":[0,0],"10":[0,0],"11":[0,0],"12":[0,0],"13":[0,0],"14":[0,0],"15":[0,0],"16":[0,0],"17":[0,0],"18":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"d183c4f4559f3fbeb05916402583e7ac9b82ad9e"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_fqe46mkqw=function(){return actualCoverage;};}return actualCoverage;}cov_fqe46mkqw();const bodyparser=(cov_fqe46mkqw().s[0]++,require("body-parser"));const express=(cov_fqe46mkqw().s[1]++,require("express"));const path=(cov_fqe46mkqw().s[2]++,require("path"));const sharp=(cov_fqe46mkqw().s[3]++,require("sharp"));const mysql=(cov_fqe46mkqw().s[4]++,require("mysql"));const settings=(cov_fqe46mkqw().s[5]++,require("./settings"));const app=(cov_fqe46mkqw().s[6]++,express());const db=(cov_fqe46mkqw().s[7]++,mysql.createConnection(settings.db));cov_fqe46mkqw().s[8]++;app.db=db;cov_fqe46mkqw().s[9]++;db.connect(err=>{cov_fqe46mkqw().f[0]++;cov_fqe46mkqw().s[10]++;if(err){cov_fqe46mkqw().b[0][0]++;cov_fqe46mkqw().s[11]++;throw err;}else{cov_fqe46mkqw().b[0][1]++;}cov_fqe46mkqw().s[12]++;console.log("db: ready");//create a table to store images
cov_fqe46mkqw().s[13]++;db.query(`CREATE TABLE IF NOT EXISTS images
		(
			id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
			date_created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
			date_used TIMESTAMP NULL DEFAULT NULL,
			name VARCHAR(300) NOT NULL,
			size INT(11) UNSIGNED NOT NULL,
			data LONGBLOB NOT NULL,
			PRIMARY KEY (id),
			UNIQUE KEY name (name)
		) 
		ENGINE=InnoDB DEFAULT CHARSET=utf8`);//preprocess any route that uses a parameter and check whether it's valid, and do some kind of stuff  
cov_fqe46mkqw().s[14]++;app.param("image",(req,res,next,image)=>{cov_fqe46mkqw().f[1]++;cov_fqe46mkqw().s[15]++;if(!image.match(/\.(png|jpg)$/i)){cov_fqe46mkqw().b[1][0]++;cov_fqe46mkqw().s[16]++;return res.status(403).end();}else{cov_fqe46mkqw().b[1][1]++;}cov_fqe46mkqw().s[17]++;db.query("SELECT * FROM images WHERE name = ?",[image],(err,images)=>{cov_fqe46mkqw().f[2]++;cov_fqe46mkqw().s[18]++;if((cov_fqe46mkqw().b[3][0]++,err)||(cov_fqe46mkqw().b[3][1]++,!images.length)){cov_fqe46mkqw().b[2][0]++;cov_fqe46mkqw().s[19]++;return res.status(404).end();}else{cov_fqe46mkqw().b[2][1]++;}cov_fqe46mkqw().s[20]++;req.image=images[0];cov_fqe46mkqw().s[21]++;return next();});});//upload image route (accept content of type image with a maximum size of 10 MB)
cov_fqe46mkqw().s[22]++;app.post("/uploads/:name",bodyparser.raw({limit:"10mb",type:"image/*"}),(req,res)=>{cov_fqe46mkqw().f[3]++;cov_fqe46mkqw().s[23]++;db.query("INSERT INTO images SET ?",{name:req.params.name,size:req.body.length,data:req.body},err=>{cov_fqe46mkqw().f[4]++;cov_fqe46mkqw().s[24]++;if(err){cov_fqe46mkqw().b[4][0]++;cov_fqe46mkqw().s[25]++;console.log(err.sqlMessage);cov_fqe46mkqw().s[26]++;return res.send({status:"error",code:err.code});}else{cov_fqe46mkqw().b[4][1]++;}cov_fqe46mkqw().s[27]++;res.send({status:"ok",size:req.body.length});});});// check image exists route	
cov_fqe46mkqw().s[28]++;app.head("/uploads/:image",(req,res)=>{cov_fqe46mkqw().f[5]++;cov_fqe46mkqw().s[29]++;return res.status(200).end();});//image manipulation route (and download)
cov_fqe46mkqw().s[30]++;app.get("/uploads/:image",(req,res)=>{cov_fqe46mkqw().f[6]++;cov_fqe46mkqw().s[31]++;//get the original image, untouched if no query params are provided
if(Object.keys(req.query).length===0){cov_fqe46mkqw().b[5][0]++;cov_fqe46mkqw().s[32]++;db.query("UPDATE images SET date_used = UTC_TIMESTAMP WHERE id = ?",[req.image.id]);cov_fqe46mkqw().s[33]++;res.setHeader("Content-Type","image/"+path.extname(req.image.name).substr(1));cov_fqe46mkqw().s[34]++;return res.end(req.image.data);}else{cov_fqe46mkqw().b[5][1]++;}//process image accordingly provided query
let image=(cov_fqe46mkqw().s[35]++,sharp(req.image.data));let width=(cov_fqe46mkqw().s[36]++,+req.query.width);let height=(cov_fqe46mkqw().s[37]++,+req.query.height);let blur=(cov_fqe46mkqw().s[38]++,+req.query.blur);let sharpen=(cov_fqe46mkqw().s[39]++,+req.query.sharpen);let greyscale=(cov_fqe46mkqw().s[40]++,["y","yes","true","1","on"].includes(req.query.greyscale));let flip=(cov_fqe46mkqw().s[41]++,["y","yes","true","1","on"].includes(req.query.flip));let flop=(cov_fqe46mkqw().s[42]++,["y","yes","true","1","on"].includes(req.query.flop));cov_fqe46mkqw().s[43]++;if((cov_fqe46mkqw().b[7][0]++,width>0)&&(cov_fqe46mkqw().b[7][1]++,height>0)){cov_fqe46mkqw().b[6][0]++;cov_fqe46mkqw().s[44]++;image.resize(width,height,{fit:"fill"});}else{cov_fqe46mkqw().b[6][1]++;}cov_fqe46mkqw().s[45]++;if((cov_fqe46mkqw().b[9][0]++,width>0)||(cov_fqe46mkqw().b[9][1]++,height>0)){cov_fqe46mkqw().b[8][0]++;cov_fqe46mkqw().s[46]++;image.resize((cov_fqe46mkqw().b[10][0]++,width)||(cov_fqe46mkqw().b[10][1]++,null),(cov_fqe46mkqw().b[11][0]++,height)||(cov_fqe46mkqw().b[11][1]++,null));}else{cov_fqe46mkqw().b[8][1]++;}cov_fqe46mkqw().s[47]++;if(blur>0){cov_fqe46mkqw().b[12][0]++;cov_fqe46mkqw().s[48]++;image.blur(blur);}else{cov_fqe46mkqw().b[12][1]++;}cov_fqe46mkqw().s[49]++;if(sharpen>0){cov_fqe46mkqw().b[13][0]++;cov_fqe46mkqw().s[50]++;image.sharpen(sharpen);}else{cov_fqe46mkqw().b[13][1]++;}cov_fqe46mkqw().s[51]++;if(greyscale){cov_fqe46mkqw().b[14][0]++;cov_fqe46mkqw().s[52]++;image.greyscale();}else{cov_fqe46mkqw().b[14][1]++;}cov_fqe46mkqw().s[53]++;if(flip){cov_fqe46mkqw().b[15][0]++;cov_fqe46mkqw().s[54]++;image.flip();}else{cov_fqe46mkqw().b[15][1]++;}cov_fqe46mkqw().s[55]++;if(flop){cov_fqe46mkqw().b[16][0]++;cov_fqe46mkqw().s[56]++;image.flop();}else{cov_fqe46mkqw().b[16][1]++;}cov_fqe46mkqw().s[57]++;db.query("UPDATE images SET date_used = UTC_TIMESTAMP WHERE id = ?",[req.image.id]);cov_fqe46mkqw().s[58]++;res.setHeader("Content-Type","image/"+path.extname(req.image.name).substr(1));cov_fqe46mkqw().s[59]++;image.pipe(res);});//delete image route
cov_fqe46mkqw().s[60]++;app.delete("/uploads/:image",(req,res)=>{cov_fqe46mkqw().f[7]++;cov_fqe46mkqw().s[61]++;db.query("DELETE FROM images WHERE id = ?",[req.image.id],err=>{cov_fqe46mkqw().f[8]++;cov_fqe46mkqw().s[62]++;return res.status(err?(cov_fqe46mkqw().b[17][0]++,500):(cov_fqe46mkqw().b[17][1]++,200)).end();});});//get db statistics route
cov_fqe46mkqw().s[63]++;app.get("/stats",(req,res)=>{cov_fqe46mkqw().f[9]++;cov_fqe46mkqw().s[64]++;db.query("SELECT COUNT(*) total, SUM(size) size, MAX(date_used) last_used FROM images",(err,rows)=>{cov_fqe46mkqw().f[10]++;cov_fqe46mkqw().s[65]++;if(err){cov_fqe46mkqw().b[18][0]++;cov_fqe46mkqw().s[66]++;return res.status(500).end();}else{cov_fqe46mkqw().b[18][1]++;}cov_fqe46mkqw().s[67]++;rows[0].uptime=process.uptime();cov_fqe46mkqw().s[68]++;return res.send(rows[0]);});});//check our database periodically and delete older images
cov_fqe46mkqw().s[69]++;setInterval(()=>{cov_fqe46mkqw().f[11]++;cov_fqe46mkqw().s[70]++;db.query("DELETE FROM images "+"WHERE (date_created < UTC_TIMETSTAMP - INTERVAL 1 WEEK AND date_used IS NULL) "+"OR (date_used < UTC_TIMETSTAMP - INTERVAL 1 MONTH)");},3600*1000);cov_fqe46mkqw().s[71]++;app.listen(3000,()=>{cov_fqe46mkqw().f[12]++;cov_fqe46mkqw().s[72]++;console.log("app: ready");});});cov_fqe46mkqw().s[73]++;module.exports=app;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImltYWdpbmkuanMiXSwibmFtZXMiOlsiYm9keXBhcnNlciIsInJlcXVpcmUiLCJleHByZXNzIiwicGF0aCIsInNoYXJwIiwibXlzcWwiLCJzZXR0aW5ncyIsImFwcCIsImRiIiwiY3JlYXRlQ29ubmVjdGlvbiIsImNvbm5lY3QiLCJlcnIiLCJjb25zb2xlIiwibG9nIiwicXVlcnkiLCJwYXJhbSIsInJlcSIsInJlcyIsIm5leHQiLCJpbWFnZSIsIm1hdGNoIiwic3RhdHVzIiwiZW5kIiwiaW1hZ2VzIiwibGVuZ3RoIiwicG9zdCIsInJhdyIsImxpbWl0IiwidHlwZSIsIm5hbWUiLCJwYXJhbXMiLCJzaXplIiwiYm9keSIsImRhdGEiLCJzcWxNZXNzYWdlIiwic2VuZCIsImNvZGUiLCJoZWFkIiwiZ2V0IiwiT2JqZWN0Iiwia2V5cyIsImlkIiwic2V0SGVhZGVyIiwiZXh0bmFtZSIsInN1YnN0ciIsIndpZHRoIiwiaGVpZ2h0IiwiYmx1ciIsInNoYXJwZW4iLCJncmV5c2NhbGUiLCJpbmNsdWRlcyIsImZsaXAiLCJmbG9wIiwicmVzaXplIiwiZml0IiwicGlwZSIsImRlbGV0ZSIsInJvd3MiLCJ1cHRpbWUiLCJwcm9jZXNzIiwic2V0SW50ZXJ2YWwiLCJsaXN0ZW4iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOGxXQWVZO3lGQWZaLEtBQU1BLENBQUFBLFVBQVUseUJBQUdDLE9BQU8sQ0FBQyxhQUFELENBQVYsQ0FBaEIsQ0FDQSxLQUFNQyxDQUFBQSxPQUFPLHlCQUFHRCxPQUFPLENBQUMsU0FBRCxDQUFWLENBQWIsQ0FDQSxLQUFNRSxDQUFBQSxJQUFJLHlCQUFHRixPQUFPLENBQUMsTUFBRCxDQUFWLENBQVYsQ0FDQSxLQUFNRyxDQUFBQSxLQUFLLHlCQUFHSCxPQUFPLENBQUMsT0FBRCxDQUFWLENBQVgsQ0FDQSxLQUFNSSxDQUFBQSxLQUFLLHlCQUFHSixPQUFPLENBQUMsT0FBRCxDQUFWLENBQVgsQ0FDQSxLQUFNSyxDQUFBQSxRQUFR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QUFELENBQU1DLEdBQU4sR0FBYyxnREFDL0JULEVBQUUsQ0FBQ00sS0FBSCxDQUFTLDZFQUFULENBQXdGLENBQUNILEdBQUQsQ0FBTThDLElBQU4sR0FBZSxpREFDdEcsR0FBSTlDLEdBQUosQ0FBUyxvREFDUixNQUFPTSxDQUFBQSxHQUFHLENBQUNJLE1BQUosQ0FBVyxHQUFYLEVBQWdCQyxHQUFoQixFQUFQLENBQ0EsQ0FGRCxpQ0FEc0csd0JBS3RHbUMsSUFBSSxDQUFDLENBQUQsQ0FBSixDQUFRQyxNQUFSLENBQWlCQyxPQUFPLENBQUNELE1BQVIsRUFBakIsQ0FMc0csd0JBTXRHLE1BQU96QyxDQUFBQSxHQUFHLENBQUNrQixJQUFKLENBQVNzQixJQUFJLENBQUMsQ0FBRCxDQUFiLENBQVAsQ0FDQSxDQVBELEVBUUEsQ0FURCxFQVdBO0FBNUdtQix3QkE2R25CRyxXQUFXLENBQUMsSUFBTSxpREFDakJwRCxFQUFFLENBQUNNLEtBQUgsQ0FBUyxzQkFDQSxnRkFEQSxDQUVBLG9EQUZULEVBR0MsQ0FKUyxDQUlQLEtBQU8sSUFKQSxDQUFYLENBN0dtQix3QkFvSG5CUCxHQUFHLENBQUNzRCxNQUFKLENBQVcsSUFBWCxDQUFpQixJQUFNLGlEQUN0QmpELE9BQU8sQ0FBQ0MsR0FBUixDQUFZLFlBQVosRUFDQSxDQUZELEVBR0EsQ0F2SEQsRSx3QkF5SEFpRCxNQUFNLENBQUNDLE9BQVAsQ0FBaUJ4RCxHQUFqQiIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGJvZHlwYXJzZXIgPSByZXF1aXJlKFwiYm9keS1wYXJzZXJcIik7XG5jb25zdCBleHByZXNzID0gcmVxdWlyZShcImV4cHJlc3NcIik7XG5jb25zdCBwYXRoID0gcmVxdWlyZShcInBhdGhcIik7XG5jb25zdCBzaGFycCA9IHJlcXVpcmUoXCJzaGFycFwiKTtcbmNvbnN0IG15c3FsID0gcmVxdWlyZShcIm15c3FsXCIpO1xuY29uc3Qgc2V0dGluZ3MgPSByZXF1aXJlKFwiLi9zZXR0aW5nc1wiKTtcblxuY29uc3QgYXBwID0gZXhwcmVzcygpO1xuY29uc3QgZGIgPSBteXNxbC5jcmVhdGVDb25uZWN0aW9uKHNldHRpbmdzLmRiKTtcblxuYXBwLmRiID0gZGI7XG5cbmRiLmNvbm5lY3QoKGVycikgPT4ge1xuXHRpZiAoZXJyKSB0aHJvdyBlcnI7XG5cblx0Y29uc29sZS5sb2coXCJkYjogcmVhZHlcIik7XG5cblx0Ly9jcmVhdGUgYSB0YWJsZSB0byBzdG9yZSBpbWFnZXNcblx0ZGIucXVlcnkoXG5cdFx0YENSRUFURSBUQUJMRSBJRiBOT1QgRVhJU1RTIGltYWdlc1xuXHRcdChcblx0XHRcdGlkIElOVCgxMSkgVU5TSUdORUQgTk9UIE5VTEwgQVVUT19JTkNSRU1FTlQsXG5cdFx0XHRkYXRlX2NyZWF0ZWQgVElNRVNUQU1QIE5PVCBOVUxMIERFRkFVTFQgQ1VSUkVOVF9USU1FU1RBTVAsXG5cdFx0XHRkYXRlX3VzZWQgVElNRVNUQU1QIE5VTEwgREVGQVVMVCBOVUxMLFxuXHRcdFx0bmFtZSBWQVJDSEFSKDMwMCkgTk9UIE5VTEwsXG5cdFx0XHRzaXplIElOVCgxMSkgVU5TSUdORUQgTk9UIE5VTEwsXG5cdFx0XHRkYXRhIExPTkdCTE9CIE5PVCBOVUxMLFxuXHRcdFx0UFJJTUFSWSBLRVkgKGlkKSxcblx0XHRcdFVOSVFVRSBLRVkgbmFtZSAobmFtZSlcblx0XHQpIFxuXHRcdEVOR0lORT1Jbm5vREIgREVGQVVMVCBDSEFSU0VUPXV0ZjhgXG5cdCk7XG5cblx0Ly9wcmVwcm9jZXNzIGFueSByb3V0ZSB0aGF0IHVzZXMgYSBwYXJhbWV0ZXIgYW5kIGNoZWNrIHdoZXRoZXIgaXQncyB2YWxpZCwgYW5kIGRvIHNvbWUga2luZCBvZiBzdHVmZiAgXG5cdGFwcC5wYXJhbShcImltYWdlXCIsIChyZXEsIHJlcywgbmV4dCwgaW1hZ2UpID0+IHtcdFx0IFxuXHRcdGlmICghaW1hZ2UubWF0Y2goL1xcLihwbmd8anBnKSQvaSkpIHtcblx0XHRcdHJldHVybiByZXMuc3RhdHVzKDQwMykuZW5kKCk7XG5cdFx0fVxuXHRcdFxuXHRcdGRiLnF1ZXJ5KFwiU0VMRUNUICogRlJPTSBpbWFnZXMgV0hFUkUgbmFtZSA9ID9cIiwgWyBpbWFnZSBdLCAoZXJyLCBpbWFnZXMpID0+IHtcdFx0XHRcblx0XHRcdGlmIChlcnIgfHwgIWltYWdlcy5sZW5ndGgpIHtcblx0XHRcdFx0cmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5lbmQoKTtcblx0XHRcdH1cblxuXHRcdFx0cmVxLmltYWdlID0gaW1hZ2VzWzBdO1xuXHRcdFx0cmV0dXJuIG5leHQoKTtcblx0XHR9KTtcblx0fSk7XG5cblx0Ly91cGxvYWQgaW1hZ2Ugcm91dGUgKGFjY2VwdCBjb250ZW50IG9mIHR5cGUgaW1hZ2Ugd2l0aCBhIG1heGltdW0gc2l6ZSBvZiAxMCBNQilcblx0YXBwLnBvc3QoXCIvdXBsb2Fkcy86bmFtZVwiLCBib2R5cGFyc2VyLnJhdyh7bGltaXQ6IFwiMTBtYlwiLCB0eXBlOiBcImltYWdlLypcIn0pLCAocmVxLCByZXMpID0+IHtcdFx0XG5cdFx0ZGIucXVlcnkoXCJJTlNFUlQgSU5UTyBpbWFnZXMgU0VUID9cIiwge25hbWU6IHJlcS5wYXJhbXMubmFtZSwgc2l6ZTogcmVxLmJvZHkubGVuZ3RoLFx0ZGF0YTogcmVxLmJvZHl9LCAoZXJyKSA9PiB7XHRcdFx0XG5cdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKGVyci5zcWxNZXNzYWdlKVxuXHRcdFx0XHRyZXR1cm4gcmVzLnNlbmQoeyBzdGF0dXMgOiBcImVycm9yXCIsIGNvZGU6IGVyci5jb2RlIH0pO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXMuc2VuZCh7IHN0YXR1cyA6IFwib2tcIiwgc2l6ZTogcmVxLmJvZHkubGVuZ3RoIH0pO1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvLyBjaGVjayBpbWFnZSBleGlzdHMgcm91dGVcdFxuXHRhcHAuaGVhZChcIi91cGxvYWRzLzppbWFnZVwiLCAocmVxLCByZXMpID0+IHtcdFx0XG5cdFx0cmV0dXJuIHJlcy5zdGF0dXMoMjAwKS5lbmQoKTtcblx0fSk7XG5cblx0Ly9pbWFnZSBtYW5pcHVsYXRpb24gcm91dGUgKGFuZCBkb3dubG9hZClcblx0YXBwLmdldChcIi91cGxvYWRzLzppbWFnZVwiLCAocmVxLCByZXMpID0+IHtcblx0XHQvL2dldCB0aGUgb3JpZ2luYWwgaW1hZ2UsIHVudG91Y2hlZCBpZiBubyBxdWVyeSBwYXJhbXMgYXJlIHByb3ZpZGVkXG5cdFx0aWYgKE9iamVjdC5rZXlzKHJlcS5xdWVyeSkubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRkYi5xdWVyeShcIlVQREFURSBpbWFnZXMgU0VUIGRhdGVfdXNlZCA9IFVUQ19USU1FU1RBTVAgV0hFUkUgaWQgPSA/XCIsIFsgcmVxLmltYWdlLmlkIF0pO1xuXHRcdFx0cmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImltYWdlL1wiICsgXG5cdFx0XHRwYXRoLmV4dG5hbWUocmVxLmltYWdlLm5hbWUpLnN1YnN0cigxKSk7XG5cdFx0XHRyZXR1cm4gcmVzLmVuZChyZXEuaW1hZ2UuZGF0YSk7XG5cdFx0fVxuXG5cdFx0Ly9wcm9jZXNzIGltYWdlIGFjY29yZGluZ2x5IHByb3ZpZGVkIHF1ZXJ5XG5cdFx0bGV0IGltYWdlID0gc2hhcnAocmVxLmltYWdlLmRhdGEpO1xuXHRcdGxldCB3aWR0aCA9ICtyZXEucXVlcnkud2lkdGg7XG5cdFx0bGV0IGhlaWdodCA9ICtyZXEucXVlcnkuaGVpZ2h0O1xuXHRcdGxldCBibHVyID0gK3JlcS5xdWVyeS5ibHVyO1xuXHRcdGxldCBzaGFycGVuID0gK3JlcS5xdWVyeS5zaGFycGVuO1xuXHRcdGxldCBncmV5c2NhbGUgPSBbIFwieVwiLCBcInllc1wiLCBcInRydWVcIiwgXCIxXCIsIFwib25cIl0uaW5jbHVkZXMocmVxLnF1ZXJ5LmdyZXlzY2FsZSk7XG5cdFx0bGV0IGZsaXAgPSBbIFwieVwiLCBcInllc1wiLCBcInRydWVcIiwgXCIxXCIsIFwib25cIl0uaW5jbHVkZXMocmVxLnF1ZXJ5LmZsaXApO1xuXHRcdGxldCBmbG9wID0gWyBcInlcIiwgXCJ5ZXNcIiwgXCJ0cnVlXCIsIFwiMVwiLCBcIm9uXCJdLmluY2x1ZGVzKHJlcS5xdWVyeS5mbG9wKTtcblx0XHRcbiAgICAgICAgaWYgKHdpZHRoID4gMCAmJiBoZWlnaHQgPiAwKSBpbWFnZS5yZXNpemUod2lkdGgsIGhlaWdodCwge2ZpdDpcImZpbGxcIn0pO1xuICAgICAgICBpZiAod2lkdGggPiAwIHx8IGhlaWdodCA+IDApIGltYWdlLnJlc2l6ZSh3aWR0aCB8fCBudWxsLCBoZWlnaHQgfHwgbnVsbCk7XG4gICAgICAgIGlmIChibHVyID4gMCkgaW1hZ2UuYmx1cihibHVyKTtcbiAgICAgICAgaWYgKHNoYXJwZW4gPiAwKSBpbWFnZS5zaGFycGVuKHNoYXJwZW4pO1xuICAgICAgICBpZiAoZ3JleXNjYWxlKSBpbWFnZS5ncmV5c2NhbGUoKTtcbiAgICAgICAgaWYgKGZsaXApIGltYWdlLmZsaXAoKTtcbiAgICAgICAgaWYgKGZsb3ApIGltYWdlLmZsb3AoKTtcdFx0XG5cblx0XHRkYi5xdWVyeShcIlVQREFURSBpbWFnZXMgU0VUIGRhdGVfdXNlZCA9IFVUQ19USU1FU1RBTVAgV0hFUkUgaWQgPSA/XCIsIFsgcmVxLmltYWdlLmlkIF0pO1xuXG5cdFx0cmVzLnNldEhlYWRlcihcIkNvbnRlbnQtVHlwZVwiLCBcImltYWdlL1wiICsgcGF0aC5leHRuYW1lKHJlcS5pbWFnZS5uYW1lKS5zdWJzdHIoMSkpO1xuXG5cdFx0aW1hZ2UucGlwZShyZXMpO1xuXHR9KTtcblxuXHQvL2RlbGV0ZSBpbWFnZSByb3V0ZVxuXHRhcHAuZGVsZXRlKFwiL3VwbG9hZHMvOmltYWdlXCIsIChyZXEsIHJlcykgPT4ge1xuXHRcdGRiLnF1ZXJ5KFwiREVMRVRFIEZST00gaW1hZ2VzIFdIRVJFIGlkID0gP1wiLCBbIHJlcS5pbWFnZS5pZCBdLCAoZXJyKSA9PiB7XG5cdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyhlcnIgPyA1MDAgOiAyMDApLmVuZCgpO1xuXHRcdH0pO1xuXHR9KTtcblxuXHQvL2dldCBkYiBzdGF0aXN0aWNzIHJvdXRlXG5cdGFwcC5nZXQoXCIvc3RhdHNcIiwgKHJlcSwgcmVzKSA9PiB7XG5cdFx0ZGIucXVlcnkoXCJTRUxFQ1QgQ09VTlQoKikgdG90YWwsIFNVTShzaXplKSBzaXplLCBNQVgoZGF0ZV91c2VkKSBsYXN0X3VzZWQgRlJPTSBpbWFnZXNcIiwgKGVyciwgcm93cykgPT4ge1xuXHRcdFx0aWYgKGVycikge1xuXHRcdFx0XHRyZXR1cm4gcmVzLnN0YXR1cyg1MDApLmVuZCgpO1xuXHRcdFx0fVxuXG5cdFx0XHRyb3dzWzBdLnVwdGltZSA9IHByb2Nlc3MudXB0aW1lKCk7XG5cdFx0XHRyZXR1cm4gcmVzLnNlbmQocm93c1swXSk7XG5cdFx0fSk7XG5cdH0pO1xuXG5cdC8vY2hlY2sgb3VyIGRhdGFiYXNlIHBlcmlvZGljYWxseSBhbmQgZGVsZXRlIG9sZGVyIGltYWdlc1xuXHRzZXRJbnRlcnZhbCgoKSA9PiB7XG5cdFx0ZGIucXVlcnkoXCJERUxFVEUgRlJPTSBpbWFnZXMgXCIgK1xuXHRcdCAgICAgICAgIFwiV0hFUkUgKGRhdGVfY3JlYXRlZCA8IFVUQ19USU1FVFNUQU1QIC0gSU5URVJWQUwgMSBXRUVLIEFORCBkYXRlX3VzZWQgSVMgTlVMTCkgXCIgK1xuXHRcdCAgICAgICAgIFwiT1IgKGRhdGVfdXNlZCA8IFVUQ19USU1FVFNUQU1QIC0gSU5URVJWQUwgMSBNT05USClcIik7XG5cdFx0fSwgMzYwMCAqIDEwMDBcblx0KTtcblxuXHRhcHAubGlzdGVuKDMwMDAsICgpID0+IHtcblx0XHRjb25zb2xlLmxvZyhcImFwcDogcmVhZHlcIik7XG5cdH0pO1xufSk7XG5cbm1vZHVsZS5leHBvcnRzID0gYXBwO1xuIl19